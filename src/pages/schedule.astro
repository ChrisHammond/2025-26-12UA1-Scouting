---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const games = (await getCollection("games"))
  .map((g) => g.data)
  .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

const teams = (await getCollection("teams")).map((t) => t.data);
const tournaments = (await getCollection("tournaments")).map((t) => t.data);
function getTeam(slug) { return teams.find((t) => t.slug === slug); }
function getTournament(slug) { return tournaments.find((t) => t.slug === slug); }
---

<BaseLayout title="Schedule – Chesterfield 12U A1">
  <h1 class="text-2xl font-bold text-red-500 mb-4">Full Schedule</h1>

  {games.length === 0 ? (
    <p class="text-gray-300">No games scheduled yet.</p>
  ) : (
    <div class="overflow-x-auto rounded-lg border border-red-600">
      <table class="min-w-full text-sm">
        <thead class="bg-red-600 text-white uppercase text-xs">
          <tr>
            <th class="px-3 py-2 text-left">Date</th>
            <th class="px-3 py-2 text-left">Opponent</th>
            <th class="px-3 py-2">Home/Away</th>
            <th class="px-3 py-2">League</th>
            <th class="px-3 py-2 text-left">Tournament</th>
            <th class="px-3 py-2 text-left">Venue</th>
            <th class="px-3 py-2 text-left">Result</th>
          </tr>
        </thead>
        <tbody class="bg-gray-900 divide-y divide-gray-700">
          {games.map((g) => {
            const opp = getTeam(g.opponent);
            const tourney = g.tournament ? getTournament(g.tournament) : null;
            return (
              <tr class="hover:bg-gray-800">
                <td class="px-3 py-2">{new Date(g.date).toLocaleDateString()}</td>
                <td class="px-3 py-2">
                  {opp ? <a href={`/teams/${opp.slug}/`} class="underline hover:text-red-400">{opp.name}</a> : g.opponent}
                </td>
                <td class="px-3 py-2">{g.homeAway}</td>
                <td class="px-3 py-2">{g.leagueGame ? "Yes" : "No"}</td>
                <td class="px-3 py-2">
                  {tourney ? <a href={`/tournaments/${tourney.slug}/`} class="underline hover:text-red-400">{tourney.name}</a> : "—"}
                </td>
                <td class="px-3 py-2">{g.venue ?? "—"}</td>
                <td class="px-3 py-2">{g.result ? `${g.result} ${g.scoreFor}-${g.scoreAgainst}` : "—"}</td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  )}
</BaseLayout>
